<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Apr 8, 2012 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>CPD Results</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20120408" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                javautil-jdbc
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
        
                <div class="xleft">
        <span id="publishDate">Last Published: 2012-04-08</span>
                  &nbsp;| <span id="projectVersion">Version: 0.11.0</span>
                      </div>
            <div class="xright">                    <a href="./" title="javautil-jdbc">javautil-jdbc</a>
              
        
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
        
                                <h5>Parent Project</h5>
                  <ul>
                  <li class="none">
                          <a href="../javautil-pom/index.html" title="javautil">javautil</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                              <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                                                              <li class="expanded">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                    <ul>
                      <li class="none">
                          <a href="apidocs/index.html" title="JavaDocs">JavaDocs</a>
            </li>
                      <li class="none">
                          <a href="testapidocs/index.html" title="Test JavaDocs">Test JavaDocs</a>
            </li>
                      <li class="none">
                          <a href="xref/index.html" title="Source Xref">Source Xref</a>
            </li>
                      <li class="none">
                          <a href="xref-test/index.html" title="Test Source Xref">Test Source Xref</a>
            </li>
                      <li class="none">
                          <a href="pmd.html" title="PMD Report">PMD Report</a>
            </li>
                      <li class="none">
            <strong>CPD Report</strong>
          </li>
                      <li class="none">
                          <a href="cobertura/index.html" title="Cobertura Test Coverage">Cobertura Test Coverage</a>
            </li>
                      <li class="none">
                          <a href="failsafe-report.html" title="Failsafe Report">Failsafe Report</a>
            </li>
                      <li class="none">
                          <a href="surefire-report.html" title="Surefire Report">Surefire Report</a>
            </li>
              </ul>
        </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
        
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>CPD Results<a name="CPD_Results"></a></h2><p>The following document contains the results of PMD's  <a class="externalLink" href="http://pmd.sourceforge.net/cpd.html">CPD</a> 4.3.</p></div><div class="section"><h2>Duplications<a name="Duplications"></a></h2><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org/javautil/jdbc/datasources/AbstractDataSource.java</td><td><a href="./xref/org/javautil/jdbc/datasources/AbstractDataSource.html#54">54</a></td></tr><tr class="a"><td>org/javautil/jdbc/datasources/ReflectionDataSource.java</td><td><a href="./xref/org/javautil/jdbc/datasources/ReflectionDataSource.html#64">64</a></td></tr><tr class="b"><td colspan='2'><div><pre>	}

	protected Map&lt;String, String&gt; getProperties() {
		return properties;
	}

	/**
	 * Returns the name of the instantiated datasource
	 * 
	 * @return
	 */
	public final String getName() {
		return name;
	}

	/**
	 * Sets the property map based on the list of properties // Order of
	 * precedence
	 * 
	 * &lt;ol&gt;
	 * &lt;li&gt;Value&lt;/li&gt;
	 * &lt;li&gt;System property&lt;/li&gt;
	 * &lt;li&gt;Environment property&lt;/li&gt;
	 * &lt;li&gt;Encrypted value&lt;/li&gt;
	 * 
	 * todo jjs encrypted value and value should be both 1 and mutually
	 * exclusive, but this is the kind of stuff you have to deal with with maps
	 * is there an indirection from the property name to the environment name or
	 * is this an ill considered refactor artifact
	 * 
	 * @param _properties
	 */
	protected final void setProperties(final List&lt;Property&gt; _properties) {
		properties.clear();
		for (final Property prop : _properties) {

			final String key = prop.getKey();
			String value = prop.getValue();
			if (value == null) {
				final String propertyKey = prop.getSys();
				if (propertyKey != null) {
					value = System.getProperty(propertyKey.trim());
				}
			}
			if (value == null) {
				final String environmentKey = prop.getEnv();
				if (environmentKey != null) {
					value = System.getenv(environmentKey.trim());
				}
			}
			if (value == null) {
				final String encryptedValue = prop.getEncryptedValue();
				if (encryptedValue != null) {
					try {
						// TODO this is devoid of merit
						value = new String(Crypto.decryptFromHex(
								encryptedValue.trim(), &quot;PA$$WORD&quot;));
					} catch (final Exception e) {
						value = null;
						throw new RuntimeException(e);
					}
				}
			}
			properties.put(key, value);
		}
	}

	/**
	 * Returns the property value
	 * 
	 * @param key
	 * @return
	 */
	public final String getProperty(final String key) {
		return properties.get(key);
	}

	/**
	 * Asserts that the given key is defined in the property map and that it has
	 * a non-zero length.
	 * 
	 * @param key
	 */
	protected final void assertPropertyDefined(final String key) {
		final String value = getProperty(key);
		if (!key.equals(&quot;password&quot;)
				&amp;&amp; (value == null || value.trim().length() == 0)) {
			throw new IllegalArgumentException(getClass().getName()
					+ &quot; requires this missing property: &quot; + key);
		}
	}

	public void testConnection() {
		try {
			final Connection conn = getConnection();
			conn.close();
		} catch (final SQLException e) {
			e.printStackTrace();
			final StringBuilder b = new StringBuilder();
			b.append(e.getMessage());
			b.append(System.getenv(&quot;line.separator&quot;));
			b.append(toString());
		}
	}

	/**
	 * General purpose method to do any necessary initialing before connections
	 * are retrieved.
	 * 
	 */
	protected void initialize() {

	}

	/*
	 * All methods below are by default not implemented.
	 * 
	 * They minimize the implementing class method requirements.
	 * 
	 * Implementing classes are free to override these as necessary.
	 */

	@Override
	public PrintWriter getLogWriter() throws SQLException {
		throw new UnsupportedOperationException();
	}

	@Override
	public int getLoginTimeout() throws SQLException {
		throw new UnsupportedOperationException();
	}

	@Override
	public void setLogWriter(final PrintWriter out) throws SQLException {
		throw new UnsupportedOperationException();
	}

	@Override
	public void setLoginTimeout(final int seconds) throws SQLException {
		throw new UnsupportedOperationException();
	}

	@Override
	public boolean isWrapperFor(final Class&lt;?&gt; iface) throws SQLException {
		throw new UnsupportedOperationException();
	}

	@Override
	public &lt;T&gt; T unwrap(final Class&lt;T&gt; iface) throws SQLException {
		throw new UnsupportedOperationException();
	}

	@Override
	public Connection getConnection(final String arg0, final String arg1)
			throws SQLException {
		throw new UnsupportedOperationException();
	}

	/**
	 * Constructs a &lt;code&gt;String&lt;/code&gt; with all attributes in name = value
	 * format.
	 * 
	 * @return a &lt;code&gt;String&lt;/code&gt; representation of this object.
	 * 
	 *         todo change the property map to not have the userName, password
	 *         and URL so that we don't have to dump the URL and so that we
	 *         don't have to expose everything converge back to pre-enhanced
	 *         version
	 * 
	 *         todo replace with AsString version excluding password
	 */
	@Override
	public String toString() {
		final String TAB = &quot;    &quot;;

		String retValue = &quot;&quot;;

		retValue = &quot;AbstractDataSource ( &quot; + super.toString() + TAB + &quot;name = &quot;
				+ this.name + TAB + &quot;properties = &quot; + this.properties + TAB
				+ &quot; )&quot;;

		return retValue;
	}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org/javautil/jdbc/metadata/JDBCTable.java</td><td><a href="./xref/org/javautil/jdbc/metadata/JDBCTable.html#47">47</a></td></tr><tr class="a"><td>org/javautil/jdbc/metadata/dao/TableJdbc.java</td><td><a href="./xref/org/javautil/jdbc/metadata/dao/TableJdbc.html#55">55</a></td></tr><tr class="b"><td colspan='2'><div><pre>	public JDBCTable(final String schemaName, final String catalogName,
			final String tableName, final String remarks, final String tableType) {
		setSchemaName(schemaName);
		setCatalogName(catalogName);
		setTableName(tableName);
		setRemarks(remarks);
		setTableType(tableType);
	}

	public void init() throws SQLException {
		init(databaseMetaData, connection);
	}

	public void init(final DatabaseMetaData meta, final Connection conn)
			throws SQLException {

		final String tablePattern = getTableName().toUpperCase();
		final String columnNamePattern = Messages.getString(&quot;Table.tableMask&quot;);
		boolean tableFound = false;
		if (tablePattern.startsWith(&quot;BIN$&quot;)) {
			logger.debug(Messages.getString(&quot;Table.recycleBinObjectMessage&quot;)
					+ tablePattern);
		} else {
			logger.debug(&quot;tablePattern '&quot; + tablePattern + &quot;' &quot;
					+ &quot; columnPattern '&quot; + columnNamePattern + &quot;'&quot;);
			final ResultSet rs = meta.getColumns(getCatalogName(),
					getSchemaName(), tablePattern, columnNamePattern);
			while (rs.next()) {
				tableFound = true;
				final Column column = new Column(rs);
				if (isDumpColumns() &amp;&amp; logger.isDebugEnabled()) {
					logger.debug(column.toString());
				}
				addColumn(column);
			}
			setMetaDataColumnsDone(System.nanoTime());
			rs.close();
			if (!tableFound) {

				throw new NonexistantTableException(
						&quot;no such table as '&quot;
								+ getTableName()
								+ &quot;' in schema &quot;
								+ &quot;'&quot;
								+ getSchemaName()
								+ &quot;' or it is not available to current user. \n&quot;
								+ &quot;No case conversion is done. \n&quot;
								+ &quot;If you did not provide in upper case, and this was not&quot;
								+ &quot; created using quoted names, try using upper case.&quot;);
			}

			if (getTableType().equals(&quot;TABLE&quot;)) {
				getExportedKeys(meta);
				setExportedKeysDone(System.nanoTime());
				getImportedKeys(meta);
				setImportedKeysDone(System.nanoTime());</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org/javautil/jdbc/metadata/JDBCForeignKeys.java</td><td><a href="./xref/org/javautil/jdbc/metadata/JDBCForeignKeys.html#24">24</a></td></tr><tr class="a"><td>org/javautil/jdbc/metadata/dao/ForeignKeysDaoJdbc.java</td><td><a href="./xref/org/javautil/jdbc/metadata/dao/ForeignKeysDaoJdbc.html#29">29</a></td></tr><tr class="b"><td colspan='2'><div><pre>	public JDBCForeignKeys(final DatabaseMetaData meta, final String catalog,
			final String schemaPattern, final String table,
			final boolean exportedKeys) throws SQLException {

		this.schemaPattern = schemaPattern;
		this.table = table;
		// boolean found = false;
		ResultSet rs;
		if (exportedKeys) {
			rs = meta.getExportedKeys(catalog, schemaPattern, table);
		} else {
			rs = meta.getImportedKeys(catalog, schemaPattern, table);
		}
		while (rs.next()) {
			// found = true;
			// System.out.println(&quot;found a foreign key&quot;);
			final ForeignKeyImpl fkey = new ForeignKeyImpl();
			fkey.setFkName(rs.getString(&quot;fk_name&quot;));

			fkey.setPktableCat(rs.getString(&quot;pktable_cat&quot;));
			fkey.setPktableSchem(rs.getString(&quot;pktable_schem&quot;));
			fkey.setPktableName(rs.getString(&quot;pktable_name&quot;));

			fkey.setFktableCat(rs.getString(&quot;fktable_cat&quot;));
			fkey.setFktableSchem(rs.getString(&quot;fktable_schem&quot;));
			fkey.setFktableName(rs.getString(&quot;fktable_name&quot;));

			fkey.setUpdateRule(rs.getShort(&quot;update_rule&quot;));
			fkey.setDeleteRule(rs.getShort(&quot;delete_rule&quot;));
			fkey.setPkName(rs.getString(&quot;pk_name&quot;));

			ForeignKey oldKey = keys.get(fkey.getId());
			if (oldKey == null) {
				oldKey = fkey;
				keys.put(fkey.getId(), fkey);
			}

			final ForeignKeyColumn col = new ForeignKeyColumn();
			col.setKeySeq(rs.getShort(&quot;key_seq&quot;));
			col.setFkcolumnName(rs.getString(&quot;fkcolumn_name&quot;));
			col.setPkcolumnName(rs.getString(&quot;pkcolumn_name&quot;));

			oldKey.addColumn(col);

		}
		rs.close();

	}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org/javautil/jdbc/metadata/PrimaryKeys.java</td><td><a href="./xref/org/javautil/jdbc/metadata/PrimaryKeys.html#14">14</a></td></tr><tr class="a"><td>org/javautil/jdbc/metadata/dao/PrimaryKeysJdbc.java</td><td><a href="./xref/org/javautil/jdbc/metadata/dao/PrimaryKeysJdbc.html#15">15</a></td></tr><tr class="b"><td colspan='2'><div><pre>	static Logger logger = Logger.getLogger(PrimaryKeys.class.getName());

	public static PrimaryKey getPrimaryKey(final DatabaseMetaData meta,
			final String catalog, final String schemaPattern,
			final String tableName) throws SQLException {
		PrimaryKey pk = null;
		final ResultSet rs = meta.getPrimaryKeys(catalog, schemaPattern,
				tableName);
		if (rs.next()) {

			final String schema = rs.getString(&quot;table_schem&quot;);
			// String tableName = rs.getString(&quot;table_name&quot;);
			final String pkName = rs.getString(&quot;pk_name&quot;);
			pk = new PrimaryKey(schema, tableName, pkName);
			short keySeq = rs.getShort(&quot;key_seq&quot;);
			String columnName = rs.getString(&quot;column_name&quot;);
			pk.addColumn(columnName, keySeq);
			while (rs.next()) {
				keySeq = rs.getShort(&quot;key_seq&quot;);
				columnName = rs.getString(&quot;column_name&quot;);
				pk.addColumn(columnName, keySeq);
			}
		}

		rs.close();

		if (pk == null) {
			logger.info(&quot; Index infos not found&quot;);
		}
		return pk;
	}

}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org/javautil/jdbc/metadata/JDBCTable.java</td><td><a href="./xref/org/javautil/jdbc/metadata/JDBCTable.html#153">153</a></td></tr><tr class="a"><td>org/javautil/jdbc/metadata/dao/TableJdbc.java</td><td><a href="./xref/org/javautil/jdbc/metadata/dao/TableJdbc.html#166">166</a></td></tr><tr class="b"><td colspan='2'><div><pre>			setPrimaryKey(PrimaryKeys.getPrimaryKey(meta, getCatalogName(),
					getSchemaName(), getTableName()));
		}
		return getPrimaryKey();
	}

	public boolean isPrimaryKeyColumn(final String columnName) {
		return getPrimaryKey() == null ? false : getPrimaryKey()
				.getColumnNames().contains(columnName);
	}

	public String[] getSelectStatementLines() {
		return getSelectStatement().split(newline);
	}

	public List&lt;ColumnAttributes&gt; getPrimaryKeyColumns(
			final DatabaseMetaData meta) throws SQLException {
		final PrimaryKey pk = getPrimaryKey(meta);
		final ArrayList&lt;ColumnAttributes&gt; pkColumns = new ArrayList&lt;ColumnAttributes&gt;();
		final Collection&lt;String&gt; columnNames = (pk == null) ? new ArrayList&lt;String&gt;()
				: pk.getColumnNames();
		if (columnNames != null) {
			for (final String columnName : columnNames) {
				pkColumns.add(getColumn(columnName));

			}
		}
		return pkColumns;
	}

}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org/javautil/jdbc/metadata/NameEscaper.java</td><td><a href="./xref/org/javautil/jdbc/metadata/NameEscaper.html#9">9</a></td></tr><tr class="a"><td>org/javautil/jdbc/metadata/renderer/SQLGenerator.java</td><td><a href="./xref/org/javautil/jdbc/metadata/renderer/SQLGenerator.html#73">73</a></td></tr><tr class="b"><td colspan='2'><div><pre>				case 'A':
				case 'B':
				case 'C':
				case 'D':
				case 'E':
				case 'F':
				case 'G':
				case 'H':
				case 'I':
				case 'J':
				case 'K':
				case 'L':
				case 'M':
				case 'N':
				case 'O':
				case 'P':
				case 'Q':
				case 'R':
				case 'S':
				case 'T':
				case 'U':
				case 'V':
				case 'W':
				case 'X':
				case 'Y':
				case 'Z':
				case '0':
				case '1':
				case '2':
				case '3':
				case '4':
				case '5':
				case '6':
				case '7':
				case '8':
				case '9':
				case '$':
				case '_':
					continue;
				default:
					retval = &quot;\&quot;&quot; + string + &quot;\&quot;&quot;;
					break;
				}
			}
		}
		if (retval == null) {
			retval = string;
		}
		return retval;

	}
}</pre></div></td></tr></table></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                   2012.
          All Rights Reserved.      
        
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
